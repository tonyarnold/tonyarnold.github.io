<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Making your iPhone app's maps work like Apple's - Tony Arnold</title>
    <meta name="author" content="Tony Arnold" />
    <meta name="description" content="The blog of Tony Arnold" />
    <link rel="canonical" href="https://tonyarnold.com/2010/04/21/making-your-iphone-apps-maps-work-like-apples.html" />
    <link rel="shortcut icon" href="/favicon.gif">
    <link rel="alternate" type="application/rss+xml" title="Tony Arnold" href="https://tonyarnold.com/atom.xml" />
    <link rel="stylesheet" href="/assets/fonts/fira/fira.css">
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/screen.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>

<body>
    <div class="container">
        <div class="four columns sidebar">
<nav>
  <h1><a href="/">Hi.</a></h1>
  <h2>I'm <a href="/about/">Tony Arnold</a>.</h2>
  <hr>
  <ul>
  <p>Spreading code and joy.</p>
  <hr>
  <div>
    <div id="social">
      <div id="stalker">
  
  <a rel="me" title="tonyarnold on Github" href="https://github.com/tonyarnold">
    <i class="fa-brands fa-github-square"></i>
  </a>
  
  
  <a rel="me" title="Tony Arnold on Mastodon" href="https://mastodon.social/@tonyarnold">
    <i class="fa-brands fa-mastodon"></i>
  </a>
  
  
  
  
  
  
  
  
  <a title="RSS feed" id="rss" href="/atom.xml">
    <i class="fa fa-rss-square"></i>
  </a>
</div>

    </div>
  </div>
  </ul>
</nav>
</div>
        <div class="eleven columns content">
<p class="meta">
  April 21, 2010
  <a href="/">
    <i class="home fa fa-home"></i>
  </a>
</p>

<h1 class="title">

  Making your iPhone app's maps work like Apple's

</h1>

<div id="post">
  <p><em><strong>Disclaimer:</strong> These instructions have been tested under iPhone SDK 3.1 - they will probably work under future releases of the iPhone OS, but I don’t make any guarantees. <strong>Don’t ever blindly include code in your apps</strong>.</em></p>

<p>I’ve had the opportunity to work on a couple of smaller iPhone apps that include <code class="language-plaintext highlighter-rouge">MKMapView</code> components to show the location of stores and other items of interest. One of the things I found a little challenging was that the map views didn’t work quite the same way as those found within Apple’s Maps.app on the iPhone. I mean, sure - you can pan around the map with your fingers and zoom in and out by pinching, so the basics are there - but once you start tracking the user’s current location (<code class="language-plaintext highlighter-rouge">showsUserLocation</code>) all the nice stuff just falls away.</p>

<p><img src="http://static.tonyarnold.com/ttm_example-1306152825.png" alt="Screenshot of TapThatMap sample app" class="center"></p>

<p>Try it now - pop open the Maps app on your iPhone and tap the little crosshair button in the lower left corner of the map to show your current location. Straight away you’ll notice that the map zooms and scrolls to centre on your current location. Now try moving the map around - the map location follows your fingers, with that pretty blue pulsing dot tailing your every move. Nice, huh? OK, now scroll the map somewhere else using your fingers. What happened? The <code class="language-plaintext highlighter-rouge">showsUserLocation</code> property just set itself to <code class="language-plaintext highlighter-rouge">NO</code> and the map stopped following you. Right thing to do, hey? Guess what - that’s not standard behaviour if you just drop an <code class="language-plaintext highlighter-rouge">MKMapView</code> into your app. The good news is that it’s not hard to copy this behaviour, and you don’t have to use private APIs either (nice!).</p>

<p>Here’s how an <code class="language-plaintext highlighter-rouge">MKMapView</code> is structured at the highest levels (in a very loose sense):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- MKMapView
  - UIView
    - UIScrollView
</code></pre></div></div>

<p>And that’s what makes it nice and easy to replicate this behaviour - the <code class="language-plaintext highlighter-rouge">UIScrollView</code> has a property named <code class="language-plaintext highlighter-rouge">contentOffset</code> that we can watch for changes using Key/Value Observation. When the <code class="language-plaintext highlighter-rouge">contentOffset</code> property changes, we can quickly check if the user is making the changes (in which case we want to turn off our <code class="language-plaintext highlighter-rouge">showsUserLocation</code> property), or if something else like the application is making the changes in which case we just want to ignore the change (ie. when zooming to a specific pin due to a search).</p>

<h2 id="sample-code">Sample Code</h2>

<p>I’ve uploaded a sample project to Github containing a very simple implementation of this approach - you’re welcome to clone it, fork it or just read through it:</p>

<div class="center">
  <p><a href="http://github.com/tonyarnold/sample-iphonesdk-tapthatmap"><img src="http://static.tonyarnold.com/xcode_project_icon-1306152857.png" alt="Xcode Project Icon" title="Xcode Project Icon (128px by 128px)">TapThatMap Sample for iPhone SDK</a></p>
</div>

<p>Hopefully this will help someone else looking to achieve the same effect. Currently, tapping the “<strong>Start Following Me</strong>” button does not zoom to and centre on the user’s location like Apple’s Maps.app, but otherwise the functionality provided by <code class="language-plaintext highlighter-rouge">MapKit.framework</code> should be enough. I’ll add more to the sample project as I get time.</p>


  
</div>

<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
    <li>
      <span>11 Jul 2018 »</span> <a href="/2018/07/11/gyb-xcode-integration.html">Integrating GYB with Xcode</a>
    </li>
    
    <li>
      <span>20 Apr 2016 »</span> <a href="/2016/04/20/xcode-build-duration.html">How to show the duration of builds in Xcode</a>
    </li>
    
    <li>
      <span>04 Feb 2015 »</span> <a href="/2015/02/04/revealution.html">Reveal 1.5</a>
    </li>
    
  </ul>
</div>

            <div class="footer">
<div class="disclaimer">
  

  <p>© Tony Arnold, 2023 — built with <a href="http://jekyllrb.com" rel="external">Jekyll</a> using the <a href="https://github.com/swanson/lagom" rel="external">Lagom theme</a>. Last updated on 27 Jul 2023.</p>
</div>
</div>
        </div>
    </div>
    

</body>

</html>
